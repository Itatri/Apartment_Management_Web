<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>RegistrationForm_v10 by Colorlib</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- LINEARICONS -->
	<link rel="stylesheet" href="~/fonts/linearicons/style.css">

	<!-- STYLE CSS -->
	<link rel="stylesheet" href="~/css/style_login.css">
</head>

<body>


	<div class="wrapper">
		<div class="inner">
			<form id="loginForm">
				<h3>Đăng nhập</h3>
				<div class="form-holder">
					<span class="lnr lnr-user"></span>
					<input type="text" id="userId" class="form-control" placeholder="Nhập ID" required>
				</div>

				<div class="form-holder">
					<span class="lnr lnr-lock"></span>
					<input type="password" id="password" class="form-control" placeholder="Nhập mật khẩu" required>
				</div>

				<button type="submit">
					<span>Đăng nhập</span>
				</button>
			</form>

		</div>
	</div>


	<script src="~/js/jquery-3.3.1.min.js"></script>
	<script src="~/js/main.js"></script>

    <script>
        $(document).ready(function() {
            // Xử lý sự kiện khi biểu mẫu được gửi
            $('#loginForm').on('submit', function(event) {
                event.preventDefault(); // Ngăn chặn hành động mặc định của biểu mẫu

                // Lấy dữ liệu từ các trường nhập liệu
                var userId = $('#userId').val();
                var password = $('#password').val();

                // Gọi API để đăng nhập
                $.ajax({
                    url: 'https://localhost:7298/api/userphongs/login', // Thay thế bằng URL của API hiện tại
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ Id: userId, MatKhau: password }),
                    success: function(response) {
                        // Nếu đăng nhập thành công
                        if (response.token) {
                            // Lưu token vào localStorage (nếu cần) hoặc sessionStorage
                            localStorage.setItem('token', response.token); // Ví dụ: lưu token để sử dụng sau này

                            // Chuyển hướng đến trang HomePageLogin
                            window.location.href = '@Url.Action("HomePageLogin", "Home")';
                        } else {
                            alert(response.message); // Hiển thị thông báo lỗi
                        }
                    },
                    error: function(xhr) {
                        alert('Đã xảy ra lỗi khi đăng nhập: ' + xhr.responseJSON.message);
                    }
                });
            });
        });
    </script>


</body>
</html>